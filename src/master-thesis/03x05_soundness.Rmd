\setcounter{section}{3}
\setcounter{subsection}{4}

## Soundness

In this section we want to prove the soundness of the inference rules with respect to the semantics. This means we want to ensure that if we can infer the well-typedness of a program, the execution of the program yields those kinds of values predicted by the inference rules.

### Soundness of the type signature

The inference rules and the semantics for the type signatures are built in a structurally similar way. Thus, we will now show that the semantics of a phrase yields the kind of result predicted by the inference rules.

```{theorem}
\label{thm:soundness_list-type-fields}
\begin{letIn}
$\Gamma$ be a type context, $\mathit{ltf}\in\mf{<list-type-fields>}$, $a_i\in\mathcal{V}$,$T_i\in\mathcal{T}$ for $i\in\mathbb{N}_1^n$ and $n\in\mathbb{N}_0$. Assume that $\Gamma\vdash \mathit{ltf}:\{a_1:T_1,\dots,a_n:T_n\}$ can be derived.
\end{letIn}
Then \(\semantic{$\mathit{ltf}$}_\Gamma = \{a_1:T_1,\dots,a_n:T_n\}\).
```
```{proof}
Let $\Gamma$ be a type context, $\mathit{ltf}\in\mf{<list-type-fields>}$, $a_i\in\mathcal{V}$,$T_i\in\mathcal{T}$ for $i\in\mathbb{N}_1^n$ and $n\in\mathbb{N}_0$. Assume $\mathit{ltf}:\{a_1:T_1,\dots,a_n:T_n\}$ can be derived.
\begin{itemize}
    \item \textbf{Case} $\mathit{ltf} = \mf{""}$ for $n = 0$: Then $\semantic{ltf} = \{ \}$ and therefore the hypothesis holds.
    \item \textbf{Case} $\mathit{ltf} = a_1 \ \mf{":"} \ T_1 \ \mf{","} \ \mathit{ltf}_1$ for $\mathit{ltf}_1\in\mf{<list-type-field>}$:
    Then by the premise of the inference rule for $\mathit{ltf}$ we can assume that $\Gamma\vdash \mathit{ltf}_1:\{a_2:T_2,\dots,a_n:T_n\}$ can be derived and by induction hypothesis \(\semantic{$\mathit{ltf}_1$}_\Gamma=\{a_2:T_2,\dots,a_n:T_n\}\). We can now use the semantics as describe in its definition \(\semantic{$ltf$}=\semantic{$a_1 \ \mf{":"} \ T_1 \ \mf{","} \ \mathit{ltf}_1$}=\{a_1:e_1,\dots,a_n:e_n\}\) for $e_i\in\text{value}_\Gamma(T_i)$ for $i\in\mathbb{N}_0^n$, thus the hypothesis \(\semantic{$\mathit{ltf}$}\in\text{value}_\Gamma(\{a_1:T_1,\dots,a_n:T_n\})\) follows.
  \end{itemize}
```

```{theorem}
\label{thm:soundness_list-type}
\begin{letIn}
$\Gamma$ be a type context, $\mathit{lt}\in\mf{<list-type>}, T_i\in\mathcal{T}$ for $i\in\mathbb{N}_1^n$ and $n\in\mathbb{N}_0$. Assume $\Gamma\vdash\mathit{lt}:(T_1,\dots,T_n)$ can be derived.
\end{letIn}
Then \(\semantic{$\mathit{lt}$}_\Gamma=(T_1,\dots,T_n)\).
```
```{proof}
See Theorem \ref{thm:soundness_type}.
```

```{theorem}
\label{thm:soundness_type}
\begin{letIn}
$\Gamma$ be a type context, $t \in\mf{<type>}$ and $T\in\mathcal{T}$. Assume $\Gamma\vdash t:T$ can be derived.
\end{letIn}
Then \(\semantic{$t$}_\Gamma = T\).
```
```{proof}
Let $\Gamma$ be a type context, $t \in\mf{<type>}$ and $T\in\mathcal{T}$. Assume $\Gamma\vdash t:T$ can be derived.
\begin{itemize}
\item\textbf{Case} $t = \mf{"Bool"}$: Then \(\semantic{$t$}_\Gamma=\mathit{Bool}\) and the hypothesis holds.
\item\textbf{Case} $t = \mf{"Int"}$: Then by the premise of the inference rule for $\mf{"Int"}$, we can assume that  $\Gamma\vdash t:\mathit{Int}$ can be derived and therefore \(\semantic{$t$}_\Gamma=\mathit{Int}\). We see that the hypothesis holds.
\item\textbf{Case} $t = \mf{"List"} \ t_2$, for $t_2\in\mf{<type>}$: By the premise of the inference rule we assume $\Gamma\vdash t_2:T_2$ can be derived and by induction hypothesis \(\semantic{$t_2$}_\Gamma = T_2\) for given $T_2\in\mathcal{T}$. Then \(\semantic{$t$}_\Gamma=[e_1,\dots,e_n]\) for $e_i\in\text{value}_\Gamma(T_2), i\in\mathbb{N}_0^n$ and $n\in\mathbb{N}$. Thus the hypothesis holds.
\item\textbf{Case} $t = \mf{"("} \ t_1 \mf{","} t_2 \ \mf{")"}$, for $t_1,t_2\in\mf{<type>}$: By the premise of the inference rule $\Gamma\vdash t_1:T_1$ and $\Gamma\vdash t_2:T_2$ hold for given $T_1,T_2\in\mathcal{T}$. Then by induction hypothesis \(\semantic{$t_1$}_\Gamma = T_1\) and \(\semantic{$t_2$}_\Gamma = T_2\). Thus by the definition of the semantic the hypothesis holds analogously to the cases above.
\item\textbf{Case} $t = \mf{"\{"} \ \mathit{ltf} \ \mf{"\}"}$, for $\mathit{ltf}\in\mf{<list-type-field>}$:
  Then by the premise of the inference rule $\Gamma\vdash \mathit{ltf}:\{a_1:T_1,\dots,a_n:T_n\}$ for $a_i\in\mathcal{V}$,$T_i\in\mathcal{T}$,$i\in\mathbb{N}_1^n$ and $n\in\mathbb{N}_0$. Thus by Theorem \ref{thm:soundness_list-type-fields} \(\semantic{$\mathit{ltf}$}_\Gamma = T\) and therefore the hypothesis holds  analogously to the cases above.
\item\textbf{Case} $t = t_1 \ \mf{"->"} \ t_2$, for $t_1,t_2\in\mf{<type>}$: By the premise of the inference rule $\Gamma\vdash t_1:T_1$ and $\Gamma\vdash t_2:T_2$ hold for given $T_1,T_2\in\mathcal{T}$. By induction hypothesis \(\semantic{$t_i$}_\Gamma = T_i\) for $i\in\{1,2\}$. Thus by the definition of the semantic the hypothesis holds  analogously to the cases above.
\item\textbf{Case} $t = c \ \mathit{lt}$ for $\mathit{lt}\in\mf{<list-type>}$ and $c\in\mf{<upper-var>}$:We will now prove Theorem \ref{thm:soundness_list-type} by using the induction hypothesis.

Assume $\Gamma\vdash\mathit{lt}:(T_1,\dots,T_n)$ can be derived, for $T_i\in\mathcal{T}$ for $i\in\mathbb{N}_1^n$ and $n\in\mathbb{N}_0$.
\begin{itemize}
  \item \textbf{Case} $\mathit{lt} = \mf{""}$ for $n = 0$: Then \(\semantic{$\mathit{lt}$}=()\) and thus the hypothesis holds.
  \item \textbf{Case} $\mathit{lt} = t_1 \ l_1$ for $l_1\in\mf{<list-type>}$:
  Then from the premise of the inference rule, we assume that $\Gamma\vdash l_1:(T_2,\dots,T_n)$ and $\Gamma\vdash t_1 : T_1$ hold. By our outer induction hypothesis \(\semantic{$t_1$}_\Gamma=T_1\) for $T_1\in\mathcal{T}$ and therefore \(\semantic{$t_1 \ l_1$}=(t_1,t_2,\dots,t_n)\) for \(\semantic{$t_i$}_\Gamma=T_i\) for $t_i\in\mf{<type>}$. Thus by the hypothesis \(\semantic{$\mathit{lt}$}=(T_1,\dots,T_n)\) holds.
\end{itemize}

We can therefore conculde that Theorem \ref{thm:soundness_list-type} holds. By the premise of the inference rule $(c,T')\in\Gamma$ with $T'\in\mathcal{T}$ and $\Gamma\vdash \mathit{lt}:(T_0,\dots,T_n)$. By Theorem \ref{thm:soundness_list-type} we know \(\semantic{$\mathit{lt}$}_\Gamma=(T_1,\dots,T_n)\) for $T_i\in\mathcal{T}$, $i\in\mathbb{N}^n$ and $n\in\mathbb{N}_0$. Thus by the definition of the semantic the hypothesis holds.
\item\textbf{Case} $t = a$ for $a\in\mathcal{V}$: Then by the definition of the semantic the hypothesis holds analogously to the cases above.
\end{itemize}
```

### Soundness of the variable context

In our previous sections we had two different meanings for $\Delta$. We now want to show, that these two definitions correlate.

```{definition,name="Similar Variable context"}
\begin{letIn}
$\Gamma,\Delta$ be type contexts and $\Delta'$ a variable context.
\end{letIn}

We say $\Delta'$ is \textit{ similar to } $\Delta$ \textit{ with respect to } $\Gamma$ iff the following holds:
  
\[ \forall T \in\mathcal{T}.\forall a \in\mathcal{V}. (a,T) \in \Delta \Rightarrow \exists e \in \text{value}_\Gamma(T). (a,e) \in \Delta'.\]
```

### Soundness of the expression semantics

We can now use the definition of well-formed variable contexts, to prove the soundness of the expression semantics.

```{theorem}
\label{thm:soundness_list-exp-field}
\begin{letIn}
$\Gamma$,$\Delta$ be type contexts, $\Delta'$ be a variable context similar to $\Delta$ with respect to $\Gamma$ and $\mathit{lef}\in\mf{<list-exp-field>}$.
Assume $\Gamma,\Delta\vdash\mathit{lef}:T$ can be derived for $T=\{a_1:T_1,\dots,a_n:T_n\}\in\mathcal{T}$, $a_i\in\mathcal{V},T_i\in\mathcal{T}$, for all $i\in\mathbb{N}_1^n$, and $n\in\mathbb{N}_0$.
\end{letIn}
Then \(\semantic{$\mathit{lef}$}_{\Gamma,\Delta'}\in\text{value}_\Gamma(T)\) .
```
```{proof}
See Theorem \ref{thm:soundness_exp}.
```

```{theorem}
\label{thm:soundness_bool}
\begin{letIn}
$b\in\mf{<bool>}.$
\end{letIn}
 Then \(\semantic{$b$}\in\text{value}_\varnothing(\mathit{Bool})\).
```
```{proof}
Let $b\in\mf{<bool>}.$
\begin{itemize}
\item\textbf{Case} $b = \mf{"True"}$: Then \(\semantic{b} = \mathit{True}\). Thus the hypothesis holds.
\item\textbf{Case} $b = \mf{"False"}$: Then \(\semantic{b} = \mathit{False}\). Thus the hypothesis holds.
\end{itemize}
```

```{theorem}
\label{thm:soundness_int}
\begin{letIn}
$i\in\mf{<int>}$.
\end{letIn}
Then \(\semantic{$i$}\in\text{value}_\varnothing(\mathit{Int})\).
```
```{proof}
Let $i\in\mf{<int>}.$
\begin{itemize}
\item\textbf{Case} $i = \mf{"0"}$: Then \(\semantic{i} = 0\). Thus the hypothesis holds.
\item\textbf{Case} $i = n$ for $n \in\mathbb{N}$: Then \(\semantic{i} = \mathit{Succ}^n \ 0\). Thus the hypothesis holds.
\item\textbf{Case} $i = \mf{"-"} \ n$ for $n \in\mathbb{N}$: Then \(\semantic{i} = \mathit{Neg} \ \mathit{Succ}^n \ 0\). Thus the hypothesis holds.
\end{itemize}
```

```{theorem}
\label{thm:soundness_list-exp}
\begin{letIn}
$\Gamma,\Delta$ be type contexts, $\Delta'$ be a variable context similar to $\Delta$ with respect to $\Gamma$ and $\mathit{le}\in\mf{<list-exp>}$.
\end{letIn}
Then \(\semantic{$\mathit{le}$}_{\Gamma,\Delta'}\in\text{value}_\Gamma(\mathit{List} \ T)\).
```
```{proof}
See Theorem \ref{thm:soundness_exp}.
```

```{theorem}
\label{thm:soundness_exp}
\begin{letIn}
$\Gamma,\Delta$ be type contexts, $\Delta'$ be a variable context similar to $\Delta$ with respect to $\Gamma$. Let $e\in\mf{<exp>}$ and $T\in\mathcal{T}$. Assume $\Delta,\Gamma\vdash e:T$ can be derived.
\end{letIn}
Then \(\semantic{$e$}_{\Gamma,\Delta'}\in\text{value}_\Gamma(T)\).
```
```{proof}
//TODO: proof 3.8

//TODO: integrate proof 3.4 into 3.8

//TODO: integrate proof 3.7 into 3.8

It follows the proof of theorem 3.4:
Let $\Gamma$,$\Delta$ be type contexts, $\Delta'$ be a variable context similar to $\Delta$ with respect to $\Gamma$ and $\mathit{lef}\in\mf{<list-exp-field>}$.
Assume the judgment $\Gamma,\Delta\vdash\mathit{lef}:T$ can be derived for $T=\{a_1:T_1,\dots,a_n:T_n\}\in\mathcal{T}$, $a_i\in\mathcal{V},T_i\in\mathcal{T}$, for all $i\in\mathbb{N}_1^n$ and given $n\in\mathbb{N}_0$.

\begin{itemize}
\item\textbf{Case} $\mathit{lef}=a_1 \ \mf{"="} \ e$ for $e\in\mf{<exp>}$ and $n = 1$: Then by the premise of the inference rule $\Gamma,\Delta\vdash e:T_1$ and therfore by our premise \(\semantic{$e$}_{\Gamma,\Delta'}\in\text{value}_\Gamma(T)\). Thus by the definition of the semantic the hypothesis holds.
\item\textbf{Case} $\mathit{lef}=a_1 \ \mf{"="} \ e \ \mf{","} \ \mathit{lef}_0$ for $e\in\mf{<exp>}$ and $lef_0\in\mf{<list-exp-field>}$: Then by the premise of the inference rule $\Gamma,\Delta\vdash \mathit{lef}_0:T$ and $\Gamma,\Delta\vdash e: T_1$ and therefore by our premise \(\semantic{$e$}_{\Gamma,\Delta'}\in\text{value}_\Gamma(T_1)\) and by induction hypothesis \(\semantic{$lef_0$}_{\Gamma,\Delta'}\in\text{value}_\Gamma(\{a_2:T_2,\dots,a_n:T_n\})\). Thus by the definition of the semantic the hypothesis holds.
\end{itemize}

```

### Soundness of the statement semantics

Statements are modelled as operations on either the type context or the variable context. We will now show that their semantics conforms to the result of the inference rules.

```{theorem}
\label{thm:soundness_list-statement-var}
\begin{letIn}
$\mathit{lsv}\in\mf{<list-statement-var>}$, $a_i\in\mathbb{N}_1^n$ for $n\in\mathbb{N}_0$. Assume $\mathit{lsv}:(a_1,\dots,a_n)$ can be derived.
\end{letIn}
Then \(\semantic{lsv}\in\mathcal{V}^*\).
```
```{proof}
//TODO: proof 3.9
```

```{theorem}
\label{thm:soundness_list-statement}
\begin{letIn}
$\Gamma_1,\Delta_1,\Gamma_2,\Delta_2$ be type contexts and $\Delta_1',\Delta_2'$ be a variable context similar to $\Delta_1,\Delta_2$, respectively, with respect to $\Gamma$. Let $\mathit{ls}\in\mf{<list-statement>}$ such that $\Gamma_1,\Delta_1,\mathit{ls}\vdash\Gamma_2,\Delta_2$ can be derived.
\end{letIn}
Then \(\semantic{$\mathit{ls}$}(\Gamma_1,\Delta_1') = (\Gamma_2,\Delta_2')\).
```
```{proof}
See Theorem \ref{thm:soundness_program}.
```

```{theorem}
\label{thm:soundness_statement}
\begin{letIn}
$\Gamma_1,\Gamma_2,\Delta_1,\Delta_2$ be type contexts and $\Delta_1',\Delta_2'$ be a variable context similar to $\Delta_1,\Delta_2$ respectively with respect to $\Gamma$. Let $s\in\mf{<statement>}$ and assume $\Gamma_1,\Delta_1,s\vdash\Gamma_2,\Delta_2$ can be derived.
\end{letIn}
Then \(\semantic{$s$}(\Gamma_1,\Delta_1') = (\Gamma_2,\Delta_2')\).
```
```{proof}
//TODO: proof 3.11
```

### Soundness of the Program Semantic

A program is a sequence of statements. Starting with an empty type context, and an empty variable context, one statement at the time will be applied, resulting in a value $e$, a type $T$ and a type context $\Gamma$ such that $e\in\text{value}_\Gamma(T)$.

```{theorem}
\label{thm:soundness_program}
\begin{letIn}
$p\in\mf{<program>}$ and $T\in\mathcal{T}$ such that $p:T$ can be derived.
\end{letIn}

Then there exists a type context $\Gamma$ such that \(\semantic{$p$}\in\text{value}_\Gamma(T)\).
```
```{proof}
//TODO: proof 3.12

//TODO: integrate proof 3.10 into 3.12
```




